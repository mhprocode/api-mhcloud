
generator client {
  provider = "prisma-client-js"
  previewFeatures = ["groupBy"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
}

enum Role {
  FREE
  PREMIUM
}

model User {
  id        Int      @id @default(autoincrement())
  name      String?
  email     String   @unique
  phone     String?
  password  String   
  role      Role     @default(FREE)
  isBanned  Boolean  @default(false)
  createdAt DateTime @default(now())
  apiKey    ApiKey? 
}

model ApiKey {
  id           Int          @id @default(autoincrement())
  key          String       @unique
  createdAt    DateTime     @default(now())
  
  userId       Int          @unique 
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  monthlyLimit Int         
  hitCount     Int          @default(0)
  lastReset    DateTime     @default(now()) 
  expiresAt    DateTime?  

  RequestLogs  RequestLog[]
  
}

model RequestLog {
  id          Int      @id @default(autoincrement())
  apiKeyId    Int
  apiKey      ApiKey   @relation(fields: [apiKeyId], references: [id], onDelete: Cascade)
  endpoint    String
  statusCode  Int
  ipAddress   String? 
  requestedAt DateTime @default(now())
}

model BannedIP {
  id        Int      @id @default(autoincrement())
  ipAddress String   @unique // IP yang diblokir
  reason    String?  
  createdAt DateTime @default(now())
}

